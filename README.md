# PetLeaf (旧: ぺっとじかめ)

> 「今日、散歩したっけ？」をなくす。多頭飼いでもサクッと記録・すぐ振り返り、家族で共有。  
> 対象: 犬/猫オーナー、とくに多頭・共働き家庭。  
> 解決: ワンタップ記録 + 自動集計で「誰がいつ何をしたか」を可視化。

---

## デモ
- Live Demo: https://pet-time-tracker.vercel.app/
- 試用アカウント: `demo@example.com / password`

## 主な価値・ユースケース
- 散歩/あそびをタイマーで計測して即保存。ワンタップで回数系も記録。
- おやつ/ケアはワンタップ追加で「誰が何回あげたか」を見える化。
- 最近の記録を自動保存しつつインライン編集・削除。ミスもすぐ修正。
- ダッシュボードで 1週間 / 1か月 / 1年 / 全期間 を切り替え、推移を確認。
- ペットの名前変更・削除も簡単。多頭対応。PWA でホーム画面から起動。

## 技術構成 / アーキテクチャ
- 運用: Vercel フロントエンド + Supabase (Auth + DB/RLS) をクライアントから直接呼び出し。
- 付録: `backend/` は FastAPI サンプル（ローカル検証・カスタム API 用のテンプレ）。本番未使用。
- Frontend: React 18, TypeScript, Vite, Tailwind CSS, React Router, Zustand, Chart.js, PWA。
- Backend: FastAPI, SQLModel/SQLite, JWT (python-jose), passlib, Pillow。
- Infra: Supabase (Auth + Database)。

## クイックスタート
```bash
cd frontend
npm install
npm run dev
```
※ Supabase の環境変数が必須です。下記「設定」を参照。

## 設定 (Env とシード)
- フロント `frontend/.env.local` (`VITE_` プレフィックス必須)
  ```
  VITE_SUPABASE_URL=https://xxxxx.supabase.co
  VITE_SUPABASE_ANON_KEY=anon_public_key
  ```
- バックエンド `backend/.env` は `.env.example` からコピー
  ```
  SECRET_KEY=任意の長い文字列
  DATABASE_URL=sqlite:///pet_tracker.db
  FRONTEND_ORIGIN=http://localhost:5173
  ```
- シードなし（Supabase は空テーブルから開始）。必要に応じて SQL で挿入。

## Supabase 初期設定 (DDL/RLS 例)
1. Auth: Email/Password を有効化。Site URL にデプロイ先ドメインを設定。
2. API から `Project URL` と `anon key` を取得しフロントで利用。
3. SQL エディタでテーブル/ポリシー作成:
```sql
create table if not exists pets (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users on delete cascade,
  name text not null,
  species text,
  weight numeric,
  birthdate date,
  created_at timestamptz default now()
);

create table if not exists activities (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users on delete cascade,
  pet_id bigint references pets(id) on delete set null,
  type activity_type not null,
  amount numeric default 0,
  unit activity_unit not null default 'none',
  started_at timestamptz not null,
  ended_at timestamptz,
  note text,
  source activity_source not null default 'manual',
  created_at timestamptz default now()
);

create index if not exists idx_activities_user_started on activities (user_id, started_at);

alter table pets enable row level security;
alter table activities enable row level security;

create policy "pets_read"   on pets for select using (auth.uid() = user_id);
create policy "pets_insert" on pets for insert with check (auth.uid() = user_id);
create policy "pets_update" on pets for update using (auth.uid() = user_id);
create policy "pets_delete" on pets for delete using (auth.uid() = user_id);

create policy "acts_read"   on activities for select using (auth.uid() = user_id);
create policy "acts_insert" on activities for insert with check (auth.uid() = user_id);
create policy "acts_update" on activities for update using (auth.uid() = user_id);
create policy "acts_delete" on activities for delete using (auth.uid() = user_id);
```

## 画面と機能
- Home: クイック記録（タイマー/ワンタップ） + 当日サマリ。
- Activities: 直近の記録をインライン編集・削除。
- Dashboard: 期間切替で散歩/遊び/おやつ/ケアを可視化。
- PetSetup: ペット登録・名前変更・削除。
- Auth: サインアップ/ログイン。Demo アカウントで試用可。

## 使い方の流れ
1. サインアップ or ログイン（メール + パスワード）。
2. ペット登録（後から追加・変更・削除も可）。
3. Home で散歩/あそびをタイマー、食事/おやつ/うんち/ケアをタップで記録。
4. Activities で数値や時間を微調整し、不要な記録を削除。
5. Dashboard で期間を切り替えて推移を確認。

## デプロイ (Vercel + Supabase) ※現行運用
1. GitHub main ブランチに push。
2. Vercel で新規プロジェクト作成。Framework: Vite / Root: `frontend` / Build: `npm run build` / Output: `dist`。
3. 環境変数に `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` を設定。
4. デプロイ後のドメインを Supabase Auth の Site URL に登録。
5. PWA: `frontend/public/sw.js` が配信され、`src/pwa/sw-register.ts` で登録。

## セキュリティと運用メモ
- 脆弱性報告は Issue かメールでお願いします。
- 依存更新: npm/pip を月次目安でアップデート。`npm audit` / `pip-audit` を定期実行。
- ライセンス: 現状 OSS ライセンスは未設定。必要に応じて追加してください。

## 問い合わせ / コントリビュート
- Issue / Discussions でフィードバック歓迎。
- 連絡先: plaintext16@gmail.com

---

## ディレクトリ構成 (抜粋)
```
frontend/         # React + Vite フロント
  src/
    pages/        # Home, Dashboard, Activities, PetSetup, Auth
    components/   # QuickActions など
    store/        # Zustand ストア
    pwa/          # Service Worker 登録
backend/          # FastAPI サンプル
  app/
  tests/
```
